// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String    @id @default(uuid())
  username        String    @unique
  email           String    @unique
  passwordHash    String    @map("password_hash")
  currentLevel    Int       @default(1) @map("current_level")
  currentXp       Int       @default(0) @map("current_xp")
  totalXpEarned   Int       @default(0) @map("total_xp_earned")
  timezone        String    @default("UTC")
  lastResetAt     DateTime? @map("last_reset_at")  // ‚Üê NEW FIELD
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  habits          Habit[]
  completions     HabitCompletion[]

  @@map("users")
}

model Habit {
  id            String    @id @default(uuid())
  userId        String    @map("user_id")
  name          String
  type          HabitType
  baseXpValue   Int       @map("base_xp_value")
  targetCount   Int       @default(1) @map("target_count")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  completions   HabitCompletion[]

  @@map("habits")
}

model HabitCompletion {
  id              String   @id @default(uuid())
  habitId         String   @map("habit_id")
  userId          String   @map("user_id")
  date            DateTime @db.Date
  completionCount Int      @default(0) @map("completion_count")
  targetCount     Int      @map("target_count")
  xpEarned        Int      @default(0) @map("xp_earned")
  currentStreak   Int      @default(0) @map("current_streak")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  habit           Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([habitId, userId, date])
  @@map("habit_completions")
}

enum HabitType {
  GOOD
  BAD
}